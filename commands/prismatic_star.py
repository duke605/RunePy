from discord.ext import commands
from util.arguments import Arguments
from util.choices import between
from shlex import split


class PrismaticStar:

    def __init__(self, bot):
        self.bot = bot

    @staticmethod
    def get_star_dict():
        return {
            'small': [74.7, 81.9, 91.8, 100.8, 111.6, 124.2, 135.9, 151.2, 166.5, 183.6, 203.4, 224.1, 246.6, 273.6, 301.5, 313.9, 328, 341.9, 356.8, 371.8, 388.6, 404.1, 421.9, 440.3, 459.1, 478.5, 499.6, 520.7, 543.1, 566.7, 591.1, 616.3, 643, 671, 699.6, 729.7, 761.7, 794.2, 829.3, 864.4, 902.2, 940.9, 981.3, 1023.7, 1067.8, 1114.5, 1164.2, 1214.7, 1266, 1321.2],
            'medium': [149.4, 163.8, 183.6, 201.6, 223.2, 248.4, 271.8, 302.4, 333, 367.2, 406.8, 448.2, 493.2, 547.2, 603, 627.7, 655.9, 683.7, 713.6, 743.5, 777.1, 808.1, 843.8, 880.6, 918.2, 957, 999.1, 1041.4, 1086.2, 1133.4, 1182.2, 1232.6, 1285.9, 1342, 1399.2, 1459.3, 1523.3, 1588.3, 1658.6, 1728.8, 1804.3, 1881.7, 1962.6, 2047.4, 2135.5, 2229, 2328.3, 2429.3, 2531.9, 2642.4, 2755.4, 2879.2, 2998.4, 3130.8, 3268.5, 3412.5, 3563.7, 3709.8, 3878.4, 4042.2, 4216.9, 4405.1, 4586.9, 4809.7, 5001.1, 5211.3, 5445.4, 5709.6, 5927.9, 6222.3, 6462.7, 6742, 7071.4, 7396.5, 7712.6, 8014.4, 8387.6, 8751.8, 9100.9, 9551.9, 9998.2, 10434, 10852.2, 11428.7, 11804.1, 12358.6, 12900.7, 13421.7, 14213.9, 14691.6, 15483.5, 15874, 16627.5, 17365.9, 18077.8, 19354.6, 20033.6, 20644.3],
            'large': [300, 331.2, 369.6, 408, 447.6, 499.2, 590.4, 609.6, 932.4, 736.8, 816, 902.4, 986.4, 1099.2, 1209.6, 1255.2, 1315.2, 1368, 1430.4, 1488, 1557.6, 1617.6, 1689.6, 1764, 1843.2, 1915.2, 1945.2, 1987.2, 2174.4, 2270.4, 2367.6, 2467.2, 2572.8, 2684.4, 2798.4, 2920.8, 3048, 3177.6, 3319.2, 3458.4, 3609.6, 3765.6, 3926.4, 4096.8, 4269.6, 4459.2, 4658.4, 4860, 5064, 5284.8, 5511.6, 5760, 5997.6, 6261.6, 6537.6, 6825.6, 7128, 7420.8, 7759.2, 8084.4, 8436, 8810.4, 9174, 9621.6, 10118.4, 10423.2, 10891.2, 11419.2, 11856, 12445.2, 12926.4, 13484.4, 14143.2, 14793.6, 15426, 16029.6, 16776, 17504.4, 18202.8, 19104, 19996.8, 20868, 21704.4, 22857.6, 23608.8, 24158.4, 25802.4, 26844, 28428, 29383.2, 30967.2, 31749.6, 33256.8, 34732.8, 36156, 38709.6, 40068, 41289.6],
            'huge': [598.8, 734.4, 739.2, 816, 895.2, 998.4, 1180.8, 1219.2, 1370.4, 1473.6, 1632, 1804.8, 1974, 2198.4, 2419.2, 2511.6, 2630.4, 2736, 2860.8, 2976, 3115.2, 3235.2, 3379.2, 3528, 3685.2, 3830.4, 3997.2, 3974.4, 4348.8, 4540.8, 4735.2, 4934.4, 5145.6, 4954.8, 5596.8, 5846.4, 6096, 6355.2, 6638.4, 6916.8, 7219.2, 7531.2, 7852.8, 8193.6, 8539.2, 8918.4, 9316.8, 9720, 10128, 10569.6, 11022, 11520, 11995.2, 12523.2, 13075.2, 13651.2, 14255.5, 14841.6, 15518.4, 16168.8, 16872, 17620.8, 18348, 19243.2, 20236.8, 20846.4, 21782.4, 22838.4, 23712, 24889.2, 25851.6, 26968.8, 28286.4, 29588.4, 30850.8, 32059.2, 33552, 35007.6, 36405.6, 38208, 39993.6, 41736, 43408.8, 45716.4, 47216.4, 49435.2, 51603.6, 53686.8, 56856, 58766.4, 61934.4, 63499.2, 66513.6, 69464.4, 72312, 77419.2, 80136, 82578]
        }

    @commands.command(aliases=['primstar', 'prim', 'prismatic', 'prismaticstar'],
                      description='Shows the amount of exp gained from using a prismatic star.')
    async def star(self, *, msg):
        parser = Arguments(allow_abbrev=False, prog='star')
        parser.add_argument('size', choices=['small', 'medium', 'large', 'huge'], help='The size of the prismatic star.')
        parser.add_argument('level', type=between(1, 120), help='The level the prismatic star will be used on.')

        try:
            args = parser.parse_args(split(msg))
        except SystemExit:
            await self.bot.say('```%s```' % parser.format_help())
            return
        except Exception as e:
            await self.bot.say('```%s```' % str(e))
            return

        xp = PrismaticStar.get_star_dict()[args.size][min(97, args.level - 1)]
        await self.bot.say('A **{}** prismatic start at level **{:,}** would yield **{:,}** XP.'
                           .format(args.size, args.level, xp))


def setup(bot):
    bot.add_cog(PrismaticStar(bot))
